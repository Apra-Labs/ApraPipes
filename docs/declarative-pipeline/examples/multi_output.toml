# Multi-Output Pipeline
# Demonstrates a pipeline where one module's output feeds multiple downstream modules
#
# This pattern is useful for parallel processing of the same video stream,
# e.g., simultaneously saving frames and running face detection.

[pipeline]
name = "MultiOutput"
version = "1.0"
description = "Single source feeding multiple processing branches"

[pipeline.settings]
queue_size = 25
on_error = "restart_module"
auto_start = false

# ============================================================
# Modules
# ============================================================

[modules.source]
type = "FileReaderModule"
    [modules.source.props]
    strFullFileNameWithPattern = "/path/to/video/frame_????.h264"
    startIndex = 0
    readLoop = true

[modules.decoder]
type = "H264Decoder"
    [modules.decoder.props]
    lowerWaterMark = 400
    upperWaterMark = 500

# Branch 1: Save decoded frames to disk
[modules.frame_saver]
type = "FileWriterModule"
    [modules.frame_saver.props]
    strFullFileNameWithPattern = "/path/to/output/decoded_????.raw"
    append = false

# Branch 2: Face detection analysis
[modules.face_detector]
type = "FaceDetectorXform"
    [modules.face_detector.props]
    scaleFactor = 1.0
    confidenceThreshold = 0.6

# Branch 3: QR code scanning
[modules.qr_reader]
type = "QRReader"

# ============================================================
# Connections
# ============================================================

# Source to decoder
[[connections]]
from = "source.output"
to = "decoder.input"

# Decoder output splits to three branches
[[connections]]
from = "decoder.output"
to = "frame_saver.input"

[[connections]]
from = "decoder.output"
to = "face_detector.input"

[[connections]]
from = "decoder.output"
to = "qr_reader.input"
