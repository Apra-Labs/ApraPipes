# 12_affine_transform_pipeline.toml
# Applies affine transformations (rotation, scale, translate) to test frames
# Chain: TestSignalGenerator -> ColorConversion -> AffineTransform -> BMPConverter -> FileWriter
#
# TEMPLATE: This pipeline has a known limitation in declarative validation.
# AffineTransform requires metadata with valid dimensions in addInputPin(),
# but the declarative pipeline creates type-only metadata for validation.
# The module works correctly at runtime when programmatically constructed.
#
# This pipeline demonstrates:
# - Generating test signal frames
# - Converting planar YUV to packed RGB (required for AffineTransform)
# - Applying rotation with scaling
# - Writing transformed frames to disk

[pipeline]
name = "Affine Transform Demo Pipeline"
description = "Demonstrates affine transformations including rotation and scaling"

# Generate test frames in YUV420 planar format
[modules.generator]
type = "TestSignalGenerator"
  [modules.generator.props]
  width = 640
  height = 480

# Convert from YUV420Planar to RGB (AffineTransform works on RawImage)
[modules.color_convert]
type = "ColorConversion"
  [modules.color_convert.props]
  conversionType = "YUV420PLANAR_TO_RGB"

# Apply affine transformation: rotate 45 degrees with 0.8 scale
[modules.transform]
type = "AffineTransform"
  [modules.transform.props]
  angle = 45.0      # Rotate 45 degrees
  scale = 0.8       # Scale down to 80%
  x = 50            # Translate 50 pixels right
  y = 30            # Translate 30 pixels down

# Encode as BMP for easy viewing
[modules.bmp_encoder]
type = "BMPConverter"

# Write transformed frames to disk
[modules.writer]
type = "FileWriterModule"
  [modules.writer.props]
  strFullFileNameWithPattern = "/tmp/declarative_test/affine_output/frame_????.bmp"

[[connections]]
from = "generator"
to = "color_convert"

[[connections]]
from = "color_convert"
to = "transform"

[[connections]]
from = "transform"
to = "bmp_encoder"

[[connections]]
from = "bmp_encoder"
to = "writer"
