<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NVIDIA CUDA Modules &mdash; Apra Pipes v0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/rtd.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CUDA Kernel Programming Guide" href="CUDAKernelProgrammingGuide.html" />
    <link rel="prev" title="Adding New Module" href="Tutorial_Adding_New_Module.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Apra Pipes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Framework.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial_Adding_New_Module.html">Adding New Module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NVIDIA CUDA Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Nvidia CUDA Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cudastream-t">cudaStream_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cudamemcopyprops">CudaMemCopyProps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jpegdecodernvjpeg">JPEGDecoderNVJPEG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jpegencodernvjpeg">JPEGEncoderNVJPEG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resizenppi">ResizeNPPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ccnppi">CCNPPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overlaynppi">OverlayNPPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#effectsnppi">EffectsNPPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#h264encodernvcodec">H264EncoderNVCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gaussianblur">GaussianBlur</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nonmaxsuppression">NonmaxSuppression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hysteresisthreshold">HysteresisThreshold</a></li>
<li class="toctree-l3"><a class="reference internal" href="#houghlinescv">HoughLinesCV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#building-pipelines">Building Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-1">Example 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2">Example 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-3">Example 3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CUDAKernelProgrammingGuide.html">CUDA Kernel Programming Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Apra Pipes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>NVIDIA CUDA Modules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/NvidiaCUDAModules.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="nvidia-cuda-modules">
<h1>NVIDIA CUDA Modules<a class="headerlink" href="#nvidia-cuda-modules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id1">
<h2>Nvidia CUDA Modules<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cudastream-t">
<h3>cudaStream_t<a class="headerlink" href="#cudastream-t" title="Permalink to this headline">¶</a></h3>
<p>Checkout <a class="reference external" href="https://docs.nvidia.com/cuda/cuda-runtime-api/group__CUDART__STREAM.html">CUDA DOCUMENTATION</a>
and <a class="reference external" href="https://developer.download.nvidia.com/CUDA/training/StreamsAndConcurrencyWebinar.pdf">CUDA WEBINAR</a></p>
<ul>
<li><div class="first line-block">
<div class="line">A sequence of operations that execute in issue-order on the GPU</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Programming model used to effect concurrency</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">CUDA operations in different streams may run concurrently</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">CUDA operations from different streams may be interleaved</div>
</div>
</li>
</ul>
<p>cudaStream_t has to be passed as props to all the CUDA modules.
cudaStreamCreate and cudaStreamDestroy is mandatory.</p>
</div>
<div class="section" id="cudamemcopyprops">
<h3>CudaMemCopyProps<a class="headerlink" href="#cudamemcopyprops" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">cudaMemcpyKind memcpyKind - cudaMemcpyDeviceToHost</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is HOST memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">sync is set to true internally</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><div class="first line-block">
<div class="line">cudaMemcpyKind memcpyKind - cudaMemcpyHostToDevice</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">Input is HOST memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><div class="first line-block">
<div class="line">sync - if sync is true, stream will be synchronized - don’t set it to true until you know what you are doing- |</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
</div>
<div class="section" id="jpegdecodernvjpeg">
<h3>JPEGDecoderNVJPEG<a class="headerlink" href="#jpegdecodernvjpeg" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is HOST memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output ImageMetadata::ImageType - MONO, YUV420, YUV444 is currently supported</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
</div>
<div class="section" id="jpegencodernvjpeg">
<h3>JPEGEncoderNVJPEG<a class="headerlink" href="#jpegencodernvjpeg" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is HOST memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">quality - default is 90</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Input ImageMetadata::ImageType - MONO, YUV420, YUV444 is currently supported</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
</div>
<div class="section" id="resizenppi">
<h3>ResizeNPPI<a class="headerlink" href="#resizenppi" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">output width and height has to be passed</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Input ImageMetadata::ImageType - MONO, YUV444, YUV420, BGR, BGRA, RGB, RGBA</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
</div>
<div class="section" id="ccnppi">
<h3>CCNPPI<a class="headerlink" href="#ccnppi" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Supported Color Conversions</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">MONO, YUV420 To BGRA</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">YUV420 To BGRA</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">YUV411_I To YUV444</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
</div>
<div class="section" id="overlaynppi">
<h3>OverlayNPPI<a class="headerlink" href="#overlaynppi" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Input ImageMetadata::ImageType - BGRA/RGBA or YUV420</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Accepts two images - Source and Overlay</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">OVERLAY_HINT has to be set to tell the module which of the two input images is the overlay image</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Overlay image width and height is expected to be less than or equal to the Source image</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">offsetX and offsetY can be given</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
</div>
<div class="section" id="effectsnppi">
<h3>EffectsNPPI<a class="headerlink" href="#effectsnppi" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Input ImageMetadata::ImageType - MONO/BGR/RGB/RGBA/BGRA/YUV420</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStream_t has to be passed</div>
</div>
</li>
</ul>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">hue</span><span class="p">;</span>            <span class="c1">// 0/255 no change [0 255]</span>
<span class="kt">double</span> <span class="n">saturation</span><span class="p">;</span>     <span class="c1">// 1 no change</span>
<span class="kt">double</span> <span class="n">contrast</span><span class="p">;</span>       <span class="c1">// 1 no change</span>
<span class="kt">int</span> <span class="n">brightness</span><span class="p">;</span>     <span class="c1">// 0 no change [-100 - 100]</span>
</pre></div>
</div>
</div>
<div class="section" id="h264encodernvcodec">
<h3>H264EncoderNVCodec<a class="headerlink" href="#h264encodernvcodec" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is HOST memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Input ImageMetadata::ImageType - BGRA/RGBA or YUV420</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">targetKbps can be passed</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">refer test - h264Encodernvcodec_tests</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">apracucontext_sp must be passed</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Initialize CudaContext before constructing the pipeline.  <cite>auto cuContext = apracucontext_sp(new ApraCUcontext());</cite></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStreamSynchronize has to be called before this module. Use one of the below methods.</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">sync = true for CudaMemCopyProps</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Add CudaStreamSynchronize Module</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="gaussianblur">
<h3>GaussianBlur<a class="headerlink" href="#gaussianblur" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Props</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">cudastream_sp</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">kernel size</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">ROI</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="nonmaxsuppression">
<h3>NonmaxSuppression<a class="headerlink" href="#nonmaxsuppression" title="Permalink to this headline">¶</a></h3>
<p>Sobel followed by nonmax suppression is applied.</p>
<ul>
<li><div class="first line-block">
<div class="line">kernel size of sobel/scharr operator is hardcoded to 3 inside the cuda kernel</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">ideally all the parameters of opencv should be supported <a class="reference external" href="https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#ga04723e007ed888ddf11d9ba04e2232de">https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#ga04723e007ed888ddf11d9ba04e2232de</a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory
- | Nonmax image
- | Phase image
- | Magnitude image can also be sent out with very minor changes</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Props</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">cudastream_sp</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">ROI</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="hysteresisthreshold">
<h3>HysteresisThreshold<a class="headerlink" href="#hysteresisthreshold" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Props</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">cudastream_sp</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">ROI</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Low Threshold</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">High Threshold</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Low Phase Threshold</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">High Phase Threshold</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="houghlinescv">
<h3>HoughLinesCV<a class="headerlink" href="#houghlinescv" title="Permalink to this headline">¶</a></h3>
<ul>
<li><div class="first line-block">
<div class="line">Input is CUDA_DEVICE memory</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Output is HOST memory of type APRA_LINES</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">cudaStreamSynchronize is automatically called in this module</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Props</div>
</div>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">cudastream_sp</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">ROI</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Minimum Line Length</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Maximum Line Gap</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="building-pipelines">
<h2>Building Pipelines<a class="headerlink" href="#building-pipelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<img alt="_images/nvidiacudamodules_1.jpg" src="_images/nvidiacudamodules_1.jpg" />
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">1920</span><span class="p">;</span>
<span class="k">auto</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">1080</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">fileReader</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">FileReaderModule</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileReaderModule</span><span class="p">(</span><span class="n">FileReaderModuleProps</span><span class="p">(</span><span class="s">&quot;./data/mono_1920x1080.raw&quot;</span><span class="p">)));</span>
<span class="k">auto</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">framemetadata_sp</span><span class="p">(</span><span class="k">new</span> <span class="n">RawImageMetadata</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">ImageMetadata</span><span class="o">::</span><span class="n">ImageType</span><span class="o">::</span><span class="n">MONO</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="n">FrameMetadata</span><span class="o">::</span><span class="n">HOST</span><span class="p">,</span> <span class="nb">true</span><span class="p">));</span>
<span class="n">fileReader</span><span class="o">-&gt;</span><span class="n">addOutputPin</span><span class="p">(</span><span class="n">metadata</span><span class="p">);</span>

<span class="n">cudaStream_t</span> <span class="n">stream</span><span class="p">;</span>
<span class="n">cudaStreamCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">copy</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">CudaMemCopy</span><span class="p">(</span><span class="n">CudaMemCopyProps</span><span class="p">(</span><span class="n">cudaMemcpyHostToDevice</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">fileReader</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">copy</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">encoder</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">JPEGEncoderNVJPEG</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">JPEGEncoderNVJPEG</span><span class="p">(</span><span class="n">JPEGEncoderNVJPEGProps</span><span class="p">(</span><span class="n">stream</span><span class="p">)));</span>
<span class="n">copy</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">fileWriter</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileWriterModule</span><span class="p">(</span><span class="s">&quot;./data/testOutput/mono_1920x1080.jpg&quot;</span><span class="p">));</span>
<span class="n">encoder</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">fileWriter</span><span class="p">);</span>

<span class="p">...</span>

<span class="n">cudaStreamDestroy</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<img alt="_images/nvidiacudamodules_2.jpg" src="_images/nvidiacudamodules_2.jpg" />
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">fileReader</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileReaderModule</span><span class="p">(</span><span class="n">FileReaderModuleProps</span><span class="p">(</span><span class="s">&quot;./data/mono_1920x960.jpg&quot;</span><span class="p">)));</span>
<span class="k">auto</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">framemetadata_sp</span><span class="p">(</span><span class="k">new</span> <span class="n">FrameMetadata</span><span class="p">(</span><span class="n">FrameMetadata</span><span class="o">::</span><span class="n">ENCODED_IMAGE</span><span class="p">));</span>
<span class="n">fileReader</span><span class="o">-&gt;</span><span class="n">addOutputPin</span><span class="p">(</span><span class="n">metadata</span><span class="p">);</span>

<span class="n">cudaStream_t</span> <span class="n">stream</span><span class="p">;</span>
<span class="n">cudaStreamCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">decoder</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">JPEGDecoderNVJPEG</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">JPEGDecoderNVJPEG</span><span class="p">(</span><span class="n">JPEGDecoderNVJPEGProps</span><span class="p">(</span><span class="n">stream</span><span class="p">)));</span>
<span class="n">fileReader</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">decoder</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">resize</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">ResizeNPPI</span><span class="p">(</span><span class="n">ResizeNPPIProps</span><span class="p">(</span><span class="mi">960</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">decoder</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">resize</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">copy</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">CudaMemCopy</span><span class="p">(</span><span class="n">CudaMemCopyProps</span><span class="p">(</span><span class="n">cudaMemcpyDeviceToHost</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">resize</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">copy</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">fileWriter</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileWriterModule</span><span class="p">(</span><span class="s">&quot;./data/testOutput/mono_1920x960_to_mono_960x480.raw&quot;</span><span class="p">));</span>
<span class="n">encoder</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">fileWriter</span><span class="p">);</span>

<span class="p">...</span>

<span class="n">cudaStreamDestroy</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<img alt="_images/nvidiacudamodules_3.jpg" src="_images/nvidiacudamodules_3.jpg" />
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">cudaStream_t</span> <span class="n">stream</span><span class="p">;</span>
<span class="n">cudaStreamCreate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>

<span class="c1">// making source pipeline - JPEGDecoderNVJPEG -&gt; ResizeNPPI -&gt; CCNPPI</span>
<span class="k">auto</span> <span class="n">fileReader</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileReaderModule</span><span class="p">(</span><span class="n">FileReaderModuleProps</span><span class="p">(</span><span class="s">&quot;./data/mono_1920x960.jpg&quot;</span><span class="p">)));</span>
<span class="k">auto</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">framemetadata_sp</span><span class="p">(</span><span class="k">new</span> <span class="n">FrameMetadata</span><span class="p">(</span><span class="n">FrameMetadata</span><span class="o">::</span><span class="n">ENCODED_IMAGE</span><span class="p">));</span>
<span class="n">fileReader</span><span class="o">-&gt;</span><span class="n">addOutputPin</span><span class="p">(</span><span class="n">metadata</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">decoder</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">JPEGDecoderNVJPEG</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">JPEGDecoderNVJPEG</span><span class="p">(</span><span class="n">JPEGDecoderNVJPEGProps</span><span class="p">(</span><span class="n">stream</span><span class="p">)));</span>
<span class="n">fileReader</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">decoder</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">resize</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">ResizeNPPI</span><span class="p">(</span><span class="n">ResizeNPPIProps</span><span class="p">(</span><span class="mi">960</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">decoder</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">resize</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">source_cc</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">CCNPPI</span><span class="p">(</span><span class="n">CCNPPIProps</span><span class="p">(</span><span class="n">ImageMetadata</span><span class="o">::</span><span class="n">BGRA</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">resize</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">source_cc</span><span class="p">);</span>

<span class="c1">// making overlay pipeline - CudaMemCopy -&gt; ResizeNPPI</span>
<span class="k">auto</span> <span class="n">overlay_host</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">FileReaderModule</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileReaderModule</span><span class="p">(</span><span class="n">FileReaderModuleProps</span><span class="p">(</span><span class="s">&quot;./data/overlay_1920x960_BGRA.raw&quot;</span><span class="p">)));</span>
<span class="k">auto</span> <span class="n">overlay_metadata</span> <span class="o">=</span> <span class="n">framemetadata_sp</span><span class="p">(</span><span class="k">new</span> <span class="n">RawImageMetadata</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="n">ImageMetadata</span><span class="o">::</span><span class="n">ImageType</span><span class="o">::</span><span class="n">BGRA</span><span class="p">,</span> <span class="n">CV_8UC4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="n">FrameMetadata</span><span class="o">::</span><span class="n">HOST</span><span class="p">,</span> <span class="nb">true</span><span class="p">));</span>
<span class="n">overlay_metadata</span><span class="o">-&gt;</span><span class="n">setHint</span><span class="p">(</span><span class="n">OVERLAY_HINT</span><span class="p">);</span>
<span class="n">overlay_host</span><span class="o">-&gt;</span><span class="n">addOutputPin</span><span class="p">(</span><span class="n">overlay_metadata</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">overlay_copy</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">CudaMemCopy</span><span class="p">(</span><span class="n">CudaMemCopyProps</span><span class="p">(</span><span class="n">cudaMemcpyHostToDevice</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">overlay_host</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">overlay_copy</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">overlay_resize</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">ResizeNPPI</span><span class="p">(</span><span class="n">ResizeNPPIProps</span><span class="p">(</span><span class="mi">960</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">stream</span><span class="p">)));</span>
<span class="n">overlay_copy</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">overlay_resize</span><span class="p">);</span>

<span class="c1">// Connecting source and overlay pipelines</span>
<span class="k">auto</span> <span class="n">overlay</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">OverlayNPPI</span><span class="p">(</span><span class="n">OverlayNPPIProps</span><span class="p">(</span><span class="n">stream</span><span class="p">)));</span>
<span class="n">overlay_resize</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">overlay</span><span class="p">);</span>
<span class="n">source_cc</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">overlay</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">encoder</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">JPEGEncoderNVJPEG</span><span class="p">(</span><span class="n">JPEGEncoderNVJPEGProps</span><span class="p">(</span><span class="n">stream</span><span class="p">)));</span>
<span class="n">overlay</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">fileWriter</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">FileWriterModule</span><span class="p">(</span><span class="s">&quot;./data/testOutput/out.jpg&quot;</span><span class="p">));</span>
<span class="n">encoder</span><span class="o">-&gt;</span><span class="n">setNext</span><span class="p">(</span><span class="n">fileWriter</span><span class="p">);</span>

<span class="p">...</span>

<span class="n">cudaStreamDestroy</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Tutorial_Adding_New_Module.html" class="btn btn-neutral float-left" title="Adding New Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CUDAKernelProgrammingGuide.html" class="btn btn-neutral float-right" title="CUDA Kernel Programming Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Apra Labs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>